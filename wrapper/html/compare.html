<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Compare Page</title>
    <link rel="stylesheet" href="../css/jk.css"/>
    <link rel="stylesheet" href="../css/compare-page.css"/>
    <script src="../js/libs/jquery/jquery.js"></script>
    <script type="text/javascript">
        $(function() {
            var $grid = $('#grid'),
                $propertiesTable = $('#properties table'),
                $productTable    = $('#products table');

            function changeBarMargins () {
                var vertical = $grid.scrollTop();
                var horizontal = $grid.scrollLeft();
                $propertiesTable.css('margin-top', -vertical);
                $productTable.css('margin-left', -horizontal);
            }

            var scrolled = false;
            $grid.scroll(function() {
                scrolled = true;
            });
            setInterval(function() {
                if (scrolled) {
                    changeBarMargins();
                    scrolled = false;
                }
            }, 30);

            /**
             * Takes a single td element wrapped by jQuery object and
             * returns the whole column with it's product head.
             *
             * Warning!
             * This selector is made only for this page, and any
             * changes to the html of tables might brake the code.
             */
            (function($) {
                $.fn.column = function () {
                    var col = $(),
                        index;

                    if (this.parents('#properties').length) {
                        return $();
                    } else if (this.parents('#products').length) {
                        index = this.index();
                        col = col.add(this);
                        col = col.add( $('#grid td').filter(function () {
                            return $(this).index() == index;
                        }) );
                    } else if (this.parents('#grid').length) {
                        //find index
                        //return nodes
                        throw new Error('This part of the selector is not developed, ' +
                                'because it wasn\'t nedded at the time');
                    } else {
                        return $();
                    }

                    return this.pushStack(col);
                };
            }) (jQuery);

            /**
             * Takes a single td element wrapped by jQuery object and
             * returns the whole row with it's property head.
             *
             * Warning!
             * This selector is made only for this page, and any
             * changes to the html of tables might brake the code.
             */
            (function($) {
                $.fn.row = function () {
                    var row = $(),
                        index;

                    if (this.parents('#product').length) {
                        return $();
                    } else if (this.parents('#properties').length) {
                        index = this.index('#properties tr');
                        row = row.add(this);
                        row = row.add( $('#grid tr').eq(index));
                    } else if (this.parents('#grid').length) {
                        index = this.index('#grid tr');
                        row = row.add('#properties tr').eq(index);
                        row = row.add(this);
                    } else {
                        return $();
                    }

                    return this.pushStack(row);
                };
            }) (jQuery);

            //sizing effect
            $(document).ready(function () {
                //set tr rows in properties table
                var $propertyRows = $('#properties tr');
                $('#grid tr').each(function (index) {
                    var height = $(this).css('height')
                    //stupid firefox bug fix
                    $propertyRows.eq(index).
                            css('height', height)
                    $(this).css('height', height);
                });
            });

            //toggle effect
            $('#properties').delegate('.heading div ', 'click', function () {
                var index = $(this).parents('tbody').
                            index(),
                    $icon = $(this).find('.state');

                $(this).parents('tbody').
                        children('tr').
                        not('.heading').
                        slideToggle(1);

                if ( $icon.hasClass('open') ) {
                    $icon.
                        removeClass('open fa-caret-down').
                        addClass('close fa-caret-left');
                } else {
                    $icon.
                            removeClass('close fa-caret-left').
                            addClass('open fa-caret-down');
                }

                $('#grid tbody').eq(index).
                        children('tr').
                        not('.space').
                        slideToggle(1);
            });

            //horizontal highlight effect
            $('#properties, #grid').delegate('tr', 'mouseover mouseout', function (e) {
                var $el = $(e.target).parents('tr'),
                    index;
                if ($el.parents('#properties').length) {
                    index = $el.index('#properties tr');
                } else {
                    index = $el.index('#grid tr');
                }

                if (e.type == 'mouseover') {
                    $el.row().addClass('highlight');
                } else {
                    $el.row().removeClass('highlight');
                }
            });

            //vertical highlight effect
            $('#products').delegate('td', 'mouseover mouseout', function (e) {
                var $el = $(e.target),
                    index = $el.parent('td').index();

                if (e.type == 'mouseover') {
                    $el.parent('td').
                            column().
                            addClass('highlight');
                } else {
                    $el.parent('td').
                            column().
                            removeClass('highlight');
                }

            });


            //remove effect
            $('#products').delegate('td .remove', 'click', function (e) {
                var $el = $(e.target);
                var index = $el.parents('td').index();
                var removeCollection = [];

                var trash = [];
                //find related tds in grid and hide them
                $el.parents('td').
                        column().
                        remove();
                updateControlView();
            });

            var updateControlView = function () {
                $('.move-left,.move-right').show();
                $('.move-left:first').hide();
                $('.move-right:last').hide();
            };

            //initialize
            $(document).ready(function () {
                updateControlView();
            });

            /**
             * Move Function
             * @param $col
             * A single td inside column wrapped by a jQuery object
             * @param index
             * The index you want to move the column to
             * @param side
             * Whether you want to move the column to the right
             * or to the left of index
             */
            var moveColumn = function ($col, index, side) {
                var $head = $(),
                    $tail = $(),
                    $gridTarget = $('#grid td').filter(function () {
                        return $(this).index() == index;
                    });

                //some validation
                if ( side != 'right' && side != 'left') {
                    throw new Error('side paramete can only ber left or right');
                }

                //find head, and tail
                $col.each(function () {
                    if( $(this).find('div').hasClass('product-ico') ) {
                        $head = $(this);
                    } else {
                        $tail = $tail.add(this)
                    }
                });

                if (side == 'right') {
                    //move head
                    $head.insertAfter($('#products td').eq(index));
                    //move tail
                    for (var i = 0; i < $tail.length; i++) {
                        $tail.eq(i).insertAfter($gridTarget.eq(i));
                    }
                } else if (side == 'left') {
                    //move head
                    $head.insertBefore($('#products td').eq(index))
                    //move tail
                    for (var i = 0; i < $tail.length; i++) {
                        $tail.eq(i).insertBefore($gridTarget.eq(i));
                    }
                }
            };

            //add column
            /**
             *
             * @param index of where you want your col to be inserted
             * @param col html column with product head and grid tail
             */
            var addColumn = function (index, col) {
                console.log($('#products td:eq(' + index + ')').column());
            };
            addColumn(1);

            //move effect
            $('#products').delegate('.move-right,.move-left', 'click', function (e) {
                var $el = $(e.target),
                    index = $el.
                            parents('td').
                            index();

                if ($el.hasClass('move-right')) {
                    moveColumn($el.parents('td').column(), index + 1, 'right');
                } else {
                    moveColumn($el.parents('td').column(), index - 1, 'left');
                }
                updateControlView();
            });

        });
    </script>
</head>
<body>

<div id="compare-wrapper">

<div id="corner">
    <div>
        <a href="#">More...</a>
    </div>
</div>

<div id="products">
    <table>
        <tbody>
        <tr>
            <td>
                <div class="product-ico">1
                    <i class="fa fa-trash-o remove control"></i>
                    <i class="fa fa-arrow-left move-left control" data-role="move-left"></i>
                    <i class="fa  fa-arrow-right move-right control" data-role="move-right"></i>
                </div>
            </td>
            <td>
                <div class="product-ico">2
                    <i class="fa fa-trash-o remove control"></i>
                    <i class="fa fa-arrow-left move-left control" data-role="move-left"></i>
                    <i class="fa  fa-arrow-right move-right control" data-role="move-right"></i>
                </div>
            </td>
            <td>
                <div class="product-ico">3
                    <i class="fa fa-trash-o remove control"></i>
                    <i class="fa fa-arrow-left move-left control" data-role="move-left"></i>
                    <i class="fa  fa-arrow-right move-right control" data-role="move-right"></i>
                </div>
            </td>
            <td>
                <div class="product-ico">4
                    <i class="fa fa-trash-o remove control"></i>
                    <i class="fa fa-arrow-left move-left control" data-role="move-left"></i>
                    <i class="fa  fa-arrow-right move-right control" data-role="move-right"></i>
                </div>
            </td>
            <td>
                <div class="product-ico">5
                    <i class="fa fa-trash-o remove control"></i>
                    <i class="fa fa-arrow-left move-left control" data-role="move-left"></i>
                    <i class="fa  fa-arrow-right move-right control" data-role="move-right"></i>
                </div>
            </td>
            <td>
                <div class="product-ico">6
                    <i class="fa fa-trash-o remove control"></i>
                    <i class="fa fa-arrow-left move-left control" data-role="move-left"></i>
                    <i class="fa  fa-arrow-right move-right control" data-role="move-right"></i>
                </div>
            </td>
            <td>
                <div class="product-ico">7
                    <i class="fa fa-trash-o remove control"></i>
                    <i class="fa fa-arrow-left move-left control" data-role="move-left"></i>
                    <i class="fa  fa-arrow-right move-right control" data-role="move-right"></i>
                </div>
            </td>
            <td>
                <div class="product-ico">8
                    <i class="fa fa-trash-o remove control"></i>
                    <i class="fa fa-arrow-left move-left control" data-role="move-left"></i>
                    <i class="fa  fa-arrow-right move-right control" data-role="move-right"></i>
                </div>
            </td>
        </tr>
        </tbody>
    </table>
</div>

<div id="properties">
    <table>
        <tbody>
        <tr class="heading">
            <td>
                <div><i class="state fa open fa-caret-down"></i>گروه</div>
            </td>
        </tr>
        <tr>
            <td>
                <div>ویژگی</div>
            </td>
        </tr>
        <tr>
            <td>
                <div>ویژگی</div>
            </td>
        </tr>
        <tr>
            <td>
                <div>ویژگی</div>
            </td>
        </tr>
        </tbody>
        <tbody>
        <tr class="heading">
            <td>
                <div><i class="state fa open fa-caret-down"></i>گروه</div>
            </td>
        </tr>
        <tr>
            <td>
                <div>ویژگی</div>
            </td>
        </tr>
        <tr>
            <td>
                <div>ویژگی</div>
            </td>
        </tr>
        <tr>
            <td>
                <div>ویژگی</div>
            </td>
        </tr>
        </tbody>
        <tbody>
        <tr class="heading">
            <td>
                <div><i class="state fa open fa-caret-down"></i>گروه</div>
            </td>
        </tr>
        <tr>
            <td>
                <div>ویژگی</div>
            </td>
        </tr>
        <tr>
            <td>
                <div>ویژگی</div>
            </td>
        </tr>
        <tr>
            <td>
                <div>ویژگی</div>
            </td>
        </tr>
        </tbody>
    </table>
</div>

<div id="grid">
    <table>
        <tbody>
        <tr class="space">
            <td>
                <div></div>
            </td>
            <td>
                <div></div>
            </td>
            <td>
                <div></div>
            </td>
            <td>
                <div></div>
            </td>
            <td>
                <div></div>
            </td>
            <td>
                <div></div>
            </td>
            <td>
                <div></div>
            </td>
            <td>
                <div></div>
            </td>
        </tr>
        <tr>
            <td>
                <div>
                    too much contetn
                    too much contetn
                    too much contetn
                    too much contetn
                    too much contetn
                    too much contetn
                    too much contetn
                </div>
            </td>
            <td>
                <div>2</div>
            </td>
            <td>
                <div>3</div>
            </td>
            <td>
                <div>4</div>
            </td>
            <td>
                <div>5</div>
            </td>
            <td>
                <div>6</div>
            </td>
            <td>
                <div>7</div>
            </td>
            <td>
                <div>8</div>
            </td>
        </tr>
        <tr>
            <td>
                <div>FF FF FF</div>
            </td>
            <td>
                <div>v2</div>
            </td>
            <td>
                <div>SS</div>
            </td>
            <td>
                <div>v2</div>
            </td>
            <td>
                <div>v2</div>
            </td>
            <td>
                <div>v2</div>
            </td>
            <td>
                <div>v2</div>
            </td>
            <td>
                <div>v2</div>
            </td>
        </tr>
        <tr>
            <td>
                <div>FF FF FF</div>
            </td>
            <td>
                <div>v3</div>
            </td>
            <td>
                <div>SS</div>
            </td>
            <td>
                <div>v3</div>
            </td>
            <td>
                <div>v3</div>
            </td>
            <td>
                <div>v3</div>
            </td>
            <td>
                <div>v3</div>
            </td>
            <td>
                <div>v3</div>
            </td>
        </tr>
        </tbody>
        <tbody>
        <tr class="space">
            <td>
                <div></div>
            </td>
            <td>
                <div></div>
            </td>
            <td>
                <div></div>
            </td>
            <td>
                <div></div>
            </td>
            <td>
                <div></div>
            </td>
            <td>
                <div></div>
            </td>
            <td>
                <div></div>
            </td>
            <td>
                <div></div>
            </td>
        </tr>
        <tr>
            <td>
                <div>v1</div>
            </td>
            <td>
                <div>v1</div>
            </td>
            <td>
                <div>v1</div>
            </td>
            <td>
                <div>v1</div>
            </td>
            <td>
                <div>v1</div>
            </td>
            <td>
                <div>v1</div>
            </td>
            <td>
                <div>v1</div>
            </td>
            <td>
                <div>v1</div>
            </td>
        </tr>
        <tr>
            <td>
                <div>v2</div>
            </td>
            <td>
                <div>v2</div>
            </td>
            <td>
                <div>
                    too much content
                    too much content
                    too much content
                    too much content
                    too much content
                    too much content
                    too much content
                </div>
            </td>
            <td>
                <div>v2</div>
            </td>
            <td>
                <div>v2</div>
            </td>
            <td>
                <div>v2</div>
            </td>
            <td>
                <div>v2</div>
            </td>
            <td>
                <div>v2</div>
            </td>
        </tr>
        <tr>
            <td>
                <div>v3</div>
            </td>
            <td>
                <div>v3</div>
            </td>
            <td>
                <div>v3</div>
            </td>
            <td>
                <div>v3</div>
            </td>
            <td>
                <div>v3</div>
            </td>
            <td>
                <div>v3</div>
            </td>
            <td>
                <div>v3</div>
            </td>
            <td>
                <div>v3</div>
            </td>
        </tr>
        </tbody>
        <tbody>
        <tr class="space">
            <td>
                <div></div>
            </td>
            <td>
                <div></div>
            </td>
            <td>
                <div></div>
            </td>
            <td>
                <div></div>
            </td>
            <td>
                <div></div>
            </td>
            <td>
                <div></div>
            </td>
            <td>
                <div></div>
            </td>
            <td>
                <div></div>
            </td>
        </tr>
        <tr>
            <td>
                <div>v1</div>
            </td>
            <td>
                <div>v1</div>
            </td>
            <td>
                <div>v1</div>
            </td>
            <td>
                <div>v1</div>
            </td>
            <td>
                <div>v1</div>
            </td>
            <td>
                <div>v1</div>
            </td>
            <td>
                <div>v1</div>
            </td>
            <td>
                <div>v1</div>
            </td>
        </tr>
        <tr>
            <td>
                <div>v2</div>
            </td>
            <td>
                <div>v2</div>
            </td>
            <td>
                <div>v2</div>
            </td>
            <td>
                <div>v2</div>
            </td>
            <td>
                <div>v2</div>
            </td>
            <td>
                <div>v2</div>
            </td>
            <td>
                <div>v2</div>
            </td>
            <td>
                <div>v2</div>
            </td>
        </tr>
        <tr>
            <td>
                <div>FF FF FF</div>
            </td>
            <td>
                <div>SS</div>
            </td>
            <td>
                <div>v2</div>
            </td>
            <td>
                <div>EE</div>
            </td>
            <td>
                <div>XXXXX</div>
            </td>
            <td>
                <div>Sira Nevada</div>
            </td>
            <td>
                <div>v3</div>
            </td>
            <td>
                <div>v3</div>
            </td>
        </tr>
        </tbody>
    </table>
</div>

</div>
</body>
</html>